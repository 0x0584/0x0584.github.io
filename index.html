<!DOCTYPE html>
<html>
  <head>
    <title>Segmentation fault at 0x0584</title>
    <link rel="stylesheet" href="style/main.css">
    <link rel="stylesheet" href="style/syntax.css">
    <meta charset="utf-8">
    <meta name="description" content="0x0584's Blog">
  </head>

  <body>
    <header>
      <nav>
	<a href="#">0x0584</a>
	<a href="#">about</a>
	<a href="#">log</a>
	<div style="float:right;">
	  <a href="https://github.com/0x0584/" class="svglink">
	    <svg arole="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
	      <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
	    </svg>
	  </a>
	  <a href="https://twitter.com/0x0584/" class="svglink">
	    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
	      <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/>
	    </svg>
	  </a>
	</div>
      </nav>
    </header>

    <h1><a href="#">Nov 19</a> - Minimal Scheme Interpreter</h1>
    <div class="container">
      <p>This is a basic Lisp (technically Scheme) interpreter that was written in C for educational purposes with the following features:</p>
      <h2 id="notes">NOTES</h2>
      <ul class="incremental">
	<li><p>Programming for me is a passion, sort of art, thus; this is just for the sake having fun while learning new stuff. And what could be more wonderful than writing your own lisp interpreter.</p></li>
	<li><p>For the purpose learning more, Lisp and Scheme are the same for the moment, so the code written in here is a mix between the two languages</p></li>
	<li><p>
	    There might be an undefined number of <strong>bugs</strong> In here, I'm aware of some and some remain unknown.</p></li>
      </ul>
      <h1 id="lisp-as-a-programming-language">Lisp as a programming language</h1>
      <p>LISP is a really old <em>functional programming language</em> that stands for literally for <em>LISt Processing</em> because it is based on a data structure called <em>List</em>. It was invented by Mr. <em>John McCarthy</em> (a genius) and the first time lisp was mentioned was in a paper published in 1959 called <a href="http://www-formal.stanford.edu/jmc/recursive.pdf">Recursive Functions of Symbolic Expressions and Their Computation by Machine</a>. Also, a nice paper published in 2002 by Mr. <em>Paul Graham</em> called <a href="http://www.paulgraham.com/rootsoflisp.html">Roots of Lisp</a> contain some useful information based on what Lisp did while being around since the first appearance in the 1959's paper as well as basic lisp functionalities and syntax</p>
      <blockquote>
	<p>Generally, Lisp is based on s-exps i.e. <em>symbolic expressions</em>. An expression is either an <em>atom</em> -- sequence of characters, or a <em>list of more expressions</em></p>
      </blockquote>
<div><pre class="highlight"><code><span class="co">;;; Comments start with &#39;;&#39;.</span>
<span class="co">;;; anything form the &#39;;&#39; to &#39;\n&#39; is ignored</span>
<span class="co">;;; This is an example of syntax supported by this interpreter</span>

<span class="co">;; Basic Arithmetic</span>
(<span class="kw">*</span> (<span class="kw">+</span> <span class="dv">3</span> (<span class="kw">/</span> <span class="dv">4</span> <span class="dv">2</span>)) (<span class="kw">-</span> <span class="dv">3</span> <span class="dv">4</span>))		<span class="co">	; -5</span>
(<span class="kw">sqrt</span> (square <span class="dv">2</span>))		    <span class="co">		; 2</span>

<span class="co">;; Build a lists and pairs using cons</span>
(define pair-one (<span class="kw">cons</span> &#39;a <span class="kw"></span>&#39;b<span class="kw"></span>))	<span class="co">		; (a . b)</span>

<span class="co">;; Defining symbols as s-expressions or lambdas</span>
(<span class="kw">define</span><span class="fu"> foo </span>(<span class="kw">+</span> <span class="dv">1</span> (<span class="kw">*</span> <span class="dv">2</span> <span class="dv">5</span>)))			<span class="co">; 11</span>
(<span class="kw">define</span><span class="fu"> bar </span>&#39;(<span class="kw">+</span> <span class="dv">1</span> <span class="dv">4</span>))		<span class="co">		; (+ 1 4)</span>
(<span class="kw">define</span><span class="fu"> baz </span>(<span class="kw">eval</span> bar))	    <span class="co">			; 5</span>
<span class="kw"></span><span class="fu"></span><span class="kw"></span><span class="kw"></span><span class="kw"></span><span class="co"></span>
(<span class="kw">define</span><span class="fu"> list-two </span>(<span class="kw">list</span> a b c))			<span class="co">; (a b c)</span>
(<span class="kw">define</span><span class="fu"> list-three </span>&#39;(a b c))	    <span class="co">		; (a b c)</span>
================================================================================
<span class="co">;; Applying car/cdr operations</span><span class="kw"></span><span class="co"></span>
(<span class="kw">cdr</span> list-two)		<span class="co">			; (b c)</span>
(<span class="kw">cadr</span> list-three)		    <span class="co">		; b</span>

<span class="co">;; Recursion with factorial</span>
(<span class="kw">define</span><span class="fu"> fact</span>
  (<span class="kw">lambda</span> (n)
    (<span class="kw">if</span> (<span class="kw">&lt;=</span> n <span class="dv">1</span>) <span class="dv">1</span>
      (<span class="kw">*</span> n (fact (<span class="kw">-</span> n <span class="dv">1</span>))))))
(fact baz)					<span class="co">; 120</span>

<span class="co">;; Recursion with fibonacci</span>
(<span class="kw">define</span><span class="fu"> fib</span>
  (<span class="kw">lambda</span> (n)
    (<span class="kw">if</span> (<span class="kw">=</span> n <span class="dv">0</span>) <span class="dv">1</span>
      (<span class="kw">if</span> (<span class="kw">=</span> n <span class="dv">1</span>) <span class="dv">1</span>
	(<span class="kw">+</span> (fib (<span class="kw">-</span> n <span class="dv">2</span>))
	  (fib (<span class="kw">-</span> n <span class="dv">1</span>)))))))
(fib foo)					<span class="co">; 144</span>

<span class="co">;; let operator</span>
(<span class="kw">let</span> ((foo (<span class="kw">list</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>)))
  (<span class="kw">cadr</span> foo))		      <span class="co">			; 2</span>

<span class="co">;; loop usign labeled let</span>
(<span class="kw">let</span> loop ((n <span class="dv">0</span>))
  (<span class="kw">if</span> (<span class="kw">&gt;</span> n <span class="dv">5</span>)
    &#39;()
    (<span class="kw">cons</span> n
      (loop (<span class="kw">+</span> n <span class="dv">1</span>)))))				<span class="co">; (0 1 2 3 4 5)</span>

<span class="co">;; map operator</span>
(map fib (<span class="kw">let</span> ((x &#39;(<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>)))
	   (<span class="kw">let</span> ((y <span class="dv">9</span>))
	     (append-to x y))))			 <span class="co">; (1 2 3 55)</span>

<span class="co">;; for more library functions check stdlib.scm</span></code></pre></div>
      <h1 id="a-basic-lisp-interpreter">A basic Lisp Interpreter</h1>
      <p>To interpret a Lisp code, we have to pass through three fundamental phases, that goes from reading the source code and identify special tokens to assembling those tokens as a single s-expression. And finally evaluating that s-expression and print the result.</p>
      <dl class="incremental">
	<dt>Lexing</dt>
	<dd><em>source code</em> → <em>vector of tokens</em>
	</dd>
	<dt>Parsing</dt>
	<dd><em>vector of tokens</em> → <em>parsed s-expression</em>
	</dd>
	<dt>Evaluation</dt>
	<dd><em>s-expression</em> → <em>result</em>
	</dd>
      </dl>
      <h2 id="lexing">Lexing</h2>
      <p>The process of lexing is where the input, i.e. source code, is <em>splited into a Vector of tokens</em>. Each token have an associated value-buffer that holds additional information about the token, e.g. the content of a string.</p>
      <blockquote>
	<p><em>NOTE:</em> See lexer.{h,c} for additional information on possible token types and their meaning.=.</p>
      </blockquote>
      <h2 id="parsing">Parsing</h2>
      <p>The process of parsing is where the tokens get converted into a s-expression. This is done by checking token, one after the other and based on the <em>token type</em> we create the correspondent s-expression until we reach the last token.</p>
      <blockquote>
	<p><em>NOTE:</em> See parser.{h,c} for additional information on the parsing process and related functions.</p>
      </blockquote>
      <h2 id="evaluation">Evaluation</h2>
      <p>The process of evaluating a s-expression is basically a recursive process. Starts by identifying the operator and pass the arguments so that we could apply the operator on those arguments. a typical s-expression would look like this:</p>
      <div><pre class="highlight"><code>(operator s-exprs...)
(define x y "ssss")
;;; comment
;; examples
(<span class="kw">define</span><span class="fu"> expr </span>&#39;(<span class="kw">*</span> <span class="dv">7</span> <span class="dv">8</span>))
(<span class="kw">eval</span> expr)
((<span class="kw">lambda</span> (n) (<span class="kw">*</span> n n)) <span class="dv">5</span>)
(<span class="kw">lambda</span> (a b) (<span class="kw">+</span> a b))</code></pre></div>
      <p>while the s-exprs could range from a single <em>atom</em> to another s-expr with it's own operator..</p>
      <blockquote>
	<p><em>NOTE:</em> See eval.{h,c} for additional information on the evaluation process and related function definitions.</p>
      </blockquote>

      <h1 id="about">build state</h1>
      <ul class="incremental">
	<li>[X] Lexing Phase
	  <ul class="incremental">
	    <li>[X] read and split text containing Scheme/Lisp syntax into tokens</li>
	    <li>[X] extract values like strings and numerical literals</li>
	</ul></li>
	<li>[-] Parsing Phase
	  <ul class="incremental">
	    <li>[X] parse the tokens into a s-expression object</li>
	    <li>[-] replace some syntactic sugar while parsing
	      <ul class="incremental">
		<li>[X] <code>(quote expr)</code> and ='expr=</li>
		<li>[ ] <code>(define f (lambda (args) (body)))</code> and <code>(define (f args) (body))</code></li>
		<li>[ ] <code>(define f (lambda (args) (body)))</code> and <code>(defun f (args) (body))</code></li>
	    </ul></li>
	</ul></li>
	<li>[X] Evaluation Phase
	  <ul class="incremental">
	    <li>[X] evaluate the parsed s-expression object</li>
	    <li>[X] support recursion</li>
	</ul></li>
	<li>[X] syntax support
	  <ul class="incremental">
	    <li>[X] arithmetic operators <code>+</code>, <code>-</code>, <code>*</code> and <code>/</code></li>
	    <li>[X] arithmetic comparison operators</li>
	    <li>[X] cons-pairs operators <code>cons</code>, <code>car</code>, <code>cdr</code>, <code>set-car</code> and <code>set-cdr</code></li>
	    <li>[X] logical operators <code>and</code>, <code>or</code> and <code>not</code></li>
	    <li>[X] defining symbols that hold values using <code>define</code>
	      <ul class="incremental">
		<li>[X] remove them using <code>undef</code></li>
		<li>[X] modify their values using <code>set</code> and <code>setq</code></li>
	    </ul></li>
	    <li>[X] conditioning using <code>if</code> and logical operators <code>and</code>, <code>or</code>, <code>not</code></li>
	    <li>[X] support lambda expressions</li>
	</ul></li>
	<li>[X] memory is handled via a garbage collector</li>
	<li>[ ] <del>support simple objects</del></li>
      </ul>
    </div>
    <footer>
      <nav>
	<a href="#">0x0584</a>
	<a href="#">about</a>
	<a href="#">log</a>
	<div style="float:right;">
	  <a href="https://github.com/0x0584/" class="svglink">
	    <svg arole="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
	      <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
	    </svg>
	  </a>
	  <a href="https://twitter.com/0x0584/" class="svglink">
	    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
	      <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"/>
	    </svg>
	  </a>
	</div>
      </nav>
    </footer>

  </body>
</html>
